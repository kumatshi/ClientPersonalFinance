<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:ClientPersonalFinance.Converters"
             x:Class="ClientPersonalFinance.Views.TransactionsPage"
             Title="Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸">

    <ContentPage.Resources>
        <converters:BalanceColorConverter x:Key="BalanceColorConverter" />
        <converters:TransactionTypeColorConverter x:Key="TransactionTypeColorConverter" />
        <converters:NotNullConverter x:Key="NotNullConverter" />
    </ContentPage.Resources>

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding RefreshCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="20" Padding="20">

                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
                <Label Text="{Binding StatusMessage}"
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center"/>

                <!-- Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ ÑÐ²Ð¾Ð´ÐºÐ° -->
                <Frame IsVisible="{Binding Summary, Converter={StaticResource NotNullConverter}}"
                       BackgroundColor="#F5F5F5" Padding="15" CornerRadius="10">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ðŸ“Š Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð°Ñ ÑÐ²Ð¾Ð´ÐºÐ°" 
                               FontSize="16" FontAttributes="Bold"/>

                        <Grid ColumnDefinitions="*,*" RowDefinitions="*,*,*" RowSpacing="8">
                            <!-- Ð”Ð¾Ñ…Ð¾Ð´Ñ‹ -->
                            <Label Text="Ð”Ð¾Ñ…Ð¾Ð´Ñ‹:" Grid.Row="0" Grid.Column="0"/>
                            <Label Text="{Binding Summary.TotalIncome, StringFormat='{0:C}'}" 
                                   Grid.Row="0" Grid.Column="1" 
                                   TextColor="#4CAF50" FontAttributes="Bold"/>

                            <!-- Ð Ð°ÑÑ…Ð¾Ð´Ñ‹ -->
                            <Label Text="Ð Ð°ÑÑ…Ð¾Ð´Ñ‹:" Grid.Row="1" Grid.Column="0"/>
                            <Label Text="{Binding Summary.TotalExpenses, StringFormat='{0:C}'}" 
                                   Grid.Row="1" Grid.Column="1" 
                                   TextColor="#F44336" FontAttributes="Bold"/>

                            <!-- Ð‘Ð°Ð»Ð°Ð½Ñ -->
                            <Label Text="Ð‘Ð°Ð»Ð°Ð½Ñ:" Grid.Row="2" Grid.Column="0"/>
                            <Label Text="{Binding Summary.Balance, StringFormat='{0:C}'}" 
                                   Grid.Row="2" Grid.Column="1" 
                                   FontAttributes="Bold"
                                   TextColor="{Binding Summary.Balance, Converter={StaticResource BalanceColorConverter}}"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº ÑÐ¿Ð¸ÑÐºÐ° -->
                <HorizontalStackLayout>
                    <Label Text="ðŸ“‹ Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸" 
                           FontSize="18" FontAttributes="Bold"
                           VerticalOptions="Center"/>

                    <Button Text="âž•"
                            Command="{Binding AddTransactionCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#2196F3"
                            FontSize="20"
                            Margin="10,0,0,0"/>
                </HorizontalStackLayout>

                <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
                <Label Text="ÐÐµÑ‚ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹" 
                       IsVisible="{Binding HasData, Converter={StaticResource NotNullConverter}, ConverterParameter=true}"
                       HorizontalOptions="Center" VerticalOptions="Center"
                       FontSize="16" TextColor="Gray" Margin="0,50"/>

                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ -->
                <CollectionView ItemsSource="{Binding Transactions}"
                                IsVisible="{Binding HasData}"
                                SelectionMode="None">

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="White" 
                                   Padding="15" CornerRadius="10"
                                   Margin="0,0,0,10"
                                   HasShadow="True">

                                <Grid ColumnDefinitions="*, Auto" RowDefinitions="*,*,*">

                                    <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ -->
                                    <Label Text="{Binding Description}" 
                                           Grid.Row="0" Grid.Column="0"
                                           FontSize="14" FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>

                                    <!-- Ð¡ÑƒÐ¼Ð¼Ð° -->
                                    <Label Text="{Binding Amount, StringFormat='{0:C}'}" 
                                           Grid.Row="0" Grid.Column="1"
                                           FontSize="16" FontAttributes="Bold"
                                           TextColor="{Binding Type, Converter={StaticResource TransactionTypeColorConverter}}"/>

                                    <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ -->
                                    <Label Text="{Binding CategoryName}" 
                                           Grid.Row="1" Grid.Column="0"
                                           FontSize="12" TextColor="Gray"/>

                                    <!-- Ð”Ð°Ñ‚Ð° -->
                                    <Label Text="{Binding Date, StringFormat='{0:dd.MM.yyyy HH:mm}'}" 
                                           Grid.Row="2" Grid.Column="1"
                                           FontSize="12" TextColor="Gray"/>

                                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ -->
                                    <Button Text="ðŸ—‘ï¸" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteTransactionCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Transparent"
                                            TextColor="#F44336"
                                            Grid.Row="1" Grid.Column="1"
                                            Grid.RowSpan="2"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð½Ð°Ð·Ð°Ð´ -->
                <Button Text="â† ÐÐ°Ð·Ð°Ð´" 
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Margin="0,20"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>