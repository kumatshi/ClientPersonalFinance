<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:ClientPersonalFinance.Converters"
             x:Class="ClientPersonalFinance.Views.AccountsPage"
             Title="Мои счета">

    <ContentPage.Resources>
        <converters:BalanceColorConverter x:Key="BalanceColorConverter" />
        <converters:NotNullConverter x:Key="NotNullConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </ContentPage.Resources>

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding LoadAccountsCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="20" Padding="20">

               
                <Label Text="{Binding StatusMessage}"
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center"/>

                
                <Frame IsVisible="{Binding HasData}"
                       BackgroundColor="Black"
                       BorderColor="White"
                       Padding="15"
                       CornerRadius="10">
                    <VerticalStackLayout Spacing="8">
                        <Label Text=" Общий баланс" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="#0D47A1"/>

                        <Label Text="{Binding TotalBalance, StringFormat='{0:C}'}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{Binding TotalBalance, Converter={StaticResource BalanceColorConverter}}"/>
                    </VerticalStackLayout>
                </Frame>

                
                <HorizontalStackLayout>
                    <Label Text=" Мои счета" 
                           FontSize="18" FontAttributes="Bold"
                           VerticalOptions="Center"/>



                </HorizontalStackLayout>

                
                <Button Text=" Загрузить счета"
                        Command="{Binding LoadAccountsCommand}"
                        BackgroundColor="Black"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData, Converter={StaticResource InverseBooleanConverter}}"/>

              

                
                <CollectionView ItemsSource="{Binding Accounts}"
                                IsVisible="{Binding HasData}"
                                SelectionMode="None">

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="Black" 
                                   Padding="15" CornerRadius="10"
                                   Margin="0,0,0,10"
                                   HasShadow="True">

                                <Grid ColumnDefinitions="*, Auto" RowDefinitions="*,*,*">
                                    
                                    <Label Text="{Binding Name}" 
                                           Grid.Row="0" Grid.Column="0"
                                           FontSize="16" FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>

                                    
                                    <Label Text="{Binding Balance, StringFormat='{0:C}'}" 
                                           Grid.Row="0" Grid.Column="1"
                                           FontSize="18" FontAttributes="Bold"
                                           TextColor="{Binding Balance, Converter={StaticResource BalanceColorConverter}}"/>

                                   
                                    <Label Text="{Binding Type}" 
                                           Grid.Row="1" Grid.Column="0"
                                           FontSize="12" TextColor="Gray"/>

                                    
                                    <Label Text="{Binding Currency}" 
                                           Grid.Row="2" Grid.Column="0"
                                           FontSize="12" TextColor="Gray"/>

                                    
                                    <Label Text="{Binding TransactionCount, StringFormat='Транзакций: {0}'}" 
                                           Grid.Row="1" Grid.Column="1"
                                           FontSize="11" TextColor="Gray"/>

                                    
                                    <Button Text="удалить" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteAccountCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Transparent"
                                            TextColor="#F44336"
                                            FontSize="16"
                                            Grid.Row="2" Grid.Column="1"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                
                <Button Text=" Обновить список" 
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData}"/>

               
                <Button Text="Назад" 
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Margin="0,20"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>