<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:ClientPersonalFinance.Converters"
             x:Class="ClientPersonalFinance.Views.AccountsPage"
             Title="ÐœÐ¾Ð¸ ÑÑ‡ÐµÑ‚Ð°">

    <ContentPage.Resources>
        <converters:BalanceColorConverter x:Key="BalanceColorConverter" />
        <converters:NotNullConverter x:Key="NotNullConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
    </ContentPage.Resources>

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding LoadAccountsCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="20" Padding="20">

                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
                <Label Text="{Binding StatusMessage}"
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center"/>

                <!-- ÐžÐ±Ñ‰Ð¸Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ -->
                <Frame IsVisible="{Binding HasData}"
                       BackgroundColor="#E3F2FD"
                       BorderColor="#2196F3"
                       Padding="15"
                       CornerRadius="10">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="ðŸ’° ÐžÐ±Ñ‰Ð¸Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="#0D47A1"/>

                        <Label Text="{Binding TotalBalance, StringFormat='{0:C}'}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="{Binding TotalBalance, Converter={StaticResource BalanceColorConverter}}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ -->
                <HorizontalStackLayout>
                    <Label Text="ðŸ’³ ÐœÐ¾Ð¸ ÑÑ‡ÐµÑ‚Ð°" 
                           FontSize="18" FontAttributes="Bold"
                           VerticalOptions="Center"/>

                    <Button Text="âž•"
                            Command="{Binding AddAccountCommand}"
                            BackgroundColor="#4CAF50"
                            TextColor="White"
                            FontSize="16"
                            CornerRadius="20"
                            Margin="10,0,5,0"
                            WidthRequest="40"
                            HeightRequest="40"/>

                    <Button Text="ðŸ”„"
                            Command="{Binding RefreshCommand}"
                            BackgroundColor="#2196F3"
                            TextColor="White"
                            FontSize="16"
                            CornerRadius="20"
                            Margin="5,0,0,0"
                            WidthRequest="40"
                            HeightRequest="40"/>
                </HorizontalStackLayout>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
                <Button Text="ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÑ‡ÐµÑ‚Ð°"
                        Command="{Binding LoadAccountsCommand}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData, Converter={StaticResource InverseBooleanConverter}}"/>

                <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
                <Label Text="ÐÐµÑ‚ ÑÑ‡ÐµÑ‚Ð¾Ð². ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÑ‡ÐµÑ‚Ð°'"
                       IsVisible="{Binding HasData, Converter={StaticResource InverseBooleanConverter}}"
                       HorizontalOptions="Center" VerticalOptions="Center"
                       FontSize="16" TextColor="Gray" Margin="0,50"/>

                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÑ‡ÐµÑ‚Ð¾Ð² -->
                <CollectionView ItemsSource="{Binding Accounts}"
                                IsVisible="{Binding HasData}"
                                SelectionMode="None">

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="White" 
                                   Padding="15" CornerRadius="10"
                                   Margin="0,0,0,10"
                                   HasShadow="True">

                                <Grid ColumnDefinitions="*, Auto" RowDefinitions="*,*,*">
                                    <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ð° -->
                                    <Label Text="{Binding Name}" 
                                           Grid.Row="0" Grid.Column="0"
                                           FontSize="16" FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>

                                    <!-- Ð‘Ð°Ð»Ð°Ð½Ñ -->
                                    <Label Text="{Binding Balance, StringFormat='{0:C}'}" 
                                           Grid.Row="0" Grid.Column="1"
                                           FontSize="18" FontAttributes="Bold"
                                           TextColor="{Binding Balance, Converter={StaticResource BalanceColorConverter}}"/>

                                    <!-- Ð¢Ð¸Ð¿ ÑÑ‡ÐµÑ‚Ð° -->
                                    <Label Text="{Binding Type}" 
                                           Grid.Row="1" Grid.Column="0"
                                           FontSize="12" TextColor="Gray"/>

                                    <!-- Ð’Ð°Ð»ÑŽÑ‚Ð° -->
                                    <Label Text="{Binding Currency}" 
                                           Grid.Row="2" Grid.Column="0"
                                           FontSize="12" TextColor="Gray"/>

                                    <!-- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ -->
                                    <Label Text="{Binding TransactionCount, StringFormat='Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹: {0}'}" 
                                           Grid.Row="1" Grid.Column="1"
                                           FontSize="11" TextColor="Gray"/>

                                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ -->
                                    <Button Text="ðŸ—‘ï¸" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteAccountCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="Transparent"
                                            TextColor="#F44336"
                                            FontSize="16"
                                            Grid.Row="2" Grid.Column="1"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ -->
                <Button Text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº" 
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData}"/>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð½Ð°Ð·Ð°Ð´ -->
                <Button Text="â† ÐÐ°Ð·Ð°Ð´" 
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Margin="0,20"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>