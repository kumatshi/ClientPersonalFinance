<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:ClientPersonalFinance.Converters"
             x:Class="ClientPersonalFinance.Views.CategoriesPage"
             Title="Категории">

    <ContentPage.Resources>
        <converters:NotNullConverter x:Key="NotNullConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:TabSelectionConverter x:Key="TabSelectionConverter" />
    </ContentPage.Resources>

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding LoadCategoriesCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="20" Padding="20">

                
                <Label Text="{Binding StatusMessage}"
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center"/>

                
                <HorizontalStackLayout>
                    <Label Text=" Категории" 
                           FontSize="18" FontAttributes="Bold"
                           VerticalOptions="Center"/>



              
                </HorizontalStackLayout>

                
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Button Text=" Загрузить все"
                            Command="{Binding LoadCategoriesCommand}"
                            BackgroundColor="Black"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            IsEnabled="{Binding IsNotBusy}"/>
                </HorizontalStackLayout>

                
               

              

                
                <VerticalStackLayout IsVisible="{Binding HasData}">

                    
                    <Frame IsVisible="{Binding IncomeCategories.Count, Converter={StaticResource NotNullConverter}}"
                           BackgroundColor="Black"
                           BorderColor="#4CAF50"
                           Padding="15"
                           CornerRadius="10"
                           Margin="0,0,0,10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text=" Категории доходов" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#2E7D32"/>

                            <CollectionView ItemsSource="{Binding IncomeCategories}"
                                            SelectionMode="None">

                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="Black" 
                                               Padding="10" CornerRadius="8"
                                               Margin="0,0,0,5">
                                            <Grid ColumnDefinitions="Auto,*,Auto">
                                                
                                                <BoxView Color="{Binding Color}"
                                                         WidthRequest="20"
                                                         HeightRequest="20"
                                                         CornerRadius="10"
                                                         Grid.Column="0"
                                                         VerticalOptions="Center"/>

                                                
                                                <Label Text="{Binding Name}" 
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       VerticalOptions="Center"
                                                       Margin="10,0"/>

                                                
                                                <Button Text="ужалить" 
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteCategoryCommand}"
                                                        CommandParameter="{Binding .}"
                                                        BackgroundColor="Transparent"
                                                        TextColor="#F44336"
                                                        FontSize="14"
                                                        Grid.Column="2"/>
                                            </Grid>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>

                   
                    <Frame IsVisible="{Binding ExpenseCategories.Count, Converter={StaticResource NotNullConverter}}"
                           BackgroundColor="#FFEBEE"
                           BorderColor="#F44336"
                           Padding="15"
                           CornerRadius="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text=" Категории расходов" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#C62828"/>

                            <CollectionView ItemsSource="{Binding ExpenseCategories}"
                                            SelectionMode="None">

                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="Black" 
                                               Padding="10" CornerRadius="8"
                                               Margin="0,0,0,5">
                                            <Grid ColumnDefinitions="Auto,*,Auto">
                                                
                                                <BoxView Color="{Binding Color}"
                                                         WidthRequest="20"
                                                         HeightRequest="20"
                                                         CornerRadius="10"
                                                         Grid.Column="0"
                                                         VerticalOptions="Center"/>

                                                
                                                <Label Text="{Binding Name}" 
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       VerticalOptions="Center"
                                                       Margin="10,0"/>

                                               
                                                <Label Text="{Binding MonthlyBudget, StringFormat='Бюджет: {0:C}'}" 
                                                       Grid.Column="1"
                                                       FontSize="12"
                                                       TextColor="Gray"
                                                       VerticalOptions="Center"
                                                       HorizontalOptions="End"/>

                                                
                                                <Button Text="удалить" 
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteCategoryCommand}"
                                                        CommandParameter="{Binding .}"
                                                        BackgroundColor="Transparent"
                                                        TextColor="#F44336"
                                                        FontSize="14"
                                                        Grid.Column="2"/>
                                            </Grid>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>

                
                <Button Text=" Обновить список" 
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="Black"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData}"/>

                
                <Button Text="Назад" 
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Margin="0,20"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>