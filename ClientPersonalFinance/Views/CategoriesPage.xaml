<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:ClientPersonalFinance.Converters"
             x:Class="ClientPersonalFinance.Views.CategoriesPage"
             Title="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸">

    <ContentPage.Resources>
        <converters:NotNullConverter x:Key="NotNullConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:TabSelectionConverter x:Key="TabSelectionConverter" />
    </ContentPage.Resources>

    <RefreshView IsRefreshing="{Binding IsBusy}"
                 Command="{Binding LoadCategoriesCommand}">

        <ScrollView>
            <VerticalStackLayout Spacing="20" Padding="20">

                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
                <Label Text="{Binding StatusMessage}"
                       FontSize="14"
                       TextColor="Gray"
                       HorizontalOptions="Center"/>

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ -->
                <HorizontalStackLayout>
                    <Label Text="ðŸ·ï¸ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸" 
                           FontSize="18" FontAttributes="Bold"
                           VerticalOptions="Center"/>

                    <Button Text="âž•"
                            Command="{Binding AddCategoryCommand}"
                            BackgroundColor="#4CAF50"
                            TextColor="White"
                            FontSize="16"
                            CornerRadius="20"
                            Margin="10,0,5,0"
                            WidthRequest="40"
                            HeightRequest="40"/>

                    <Button Text="ðŸ”„"
                            Command="{Binding RefreshCommand}"
                            BackgroundColor="#2196F3"
                            TextColor="White"
                            FontSize="16"
                            CornerRadius="20"
                            Margin="5,0,0,0"
                            WidthRequest="40"
                            HeightRequest="40"/>
                </HorizontalStackLayout>

                <!-- Ð£Ð¿Ñ€Ð¾Ñ‰ÐµÐ½Ð½Ñ‹Ðµ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ -->
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Button Text="ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð²ÑÐµ"
                            Command="{Binding LoadCategoriesCommand}"
                            BackgroundColor="#FF9800"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="40"
                            IsEnabled="{Binding IsNotBusy}"/>
                </HorizontalStackLayout>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ ÐµÑÐ»Ð¸ Ð½ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
                <Button Text="ðŸ“¥ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸"
                        Command="{Binding LoadCategoriesCommand}"
                        BackgroundColor="#FF9800"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData, Converter={StaticResource InverseBooleanConverter}}"/>

                <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
                <Label Text="ÐÐµÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸'"
                       IsVisible="{Binding HasData, Converter={StaticResource InverseBooleanConverter}}"
                       HorizontalOptions="Center" VerticalOptions="Center"
                       FontSize="16" TextColor="Gray" Margin="0,50"/>

                <!-- Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                <VerticalStackLayout IsVisible="{Binding HasData}">

                    <!-- Ð”Ð¾Ñ…Ð¾Ð´Ñ‹ -->
                    <Frame IsVisible="{Binding IncomeCategories.Count, Converter={StaticResource NotNullConverter}}"
                           BackgroundColor="#E8F5E9"
                           BorderColor="#4CAF50"
                           Padding="15"
                           CornerRadius="10"
                           Margin="0,0,0,10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ“ˆ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð´Ð¾Ñ…Ð¾Ð´Ð¾Ð²" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#2E7D32"/>

                            <CollectionView ItemsSource="{Binding IncomeCategories}"
                                            SelectionMode="None">

                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="White" 
                                               Padding="10" CornerRadius="8"
                                               Margin="0,0,0,5">
                                            <Grid ColumnDefinitions="Auto,*,Auto">
                                                <!-- Ð¦Ð²ÐµÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                                                <BoxView Color="{Binding Color}"
                                                         WidthRequest="20"
                                                         HeightRequest="20"
                                                         CornerRadius="10"
                                                         Grid.Column="0"
                                                         VerticalOptions="Center"/>

                                                <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                                                <Label Text="{Binding Name}" 
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       VerticalOptions="Center"
                                                       Margin="10,0"/>

                                                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ -->
                                                <Button Text="ðŸ—‘ï¸" 
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteCategoryCommand}"
                                                        CommandParameter="{Binding .}"
                                                        BackgroundColor="Transparent"
                                                        TextColor="#F44336"
                                                        FontSize="14"
                                                        Grid.Column="2"/>
                                            </Grid>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Ð Ð°ÑÑ…Ð¾Ð´Ñ‹ -->
                    <Frame IsVisible="{Binding ExpenseCategories.Count, Converter={StaticResource NotNullConverter}}"
                           BackgroundColor="#FFEBEE"
                           BorderColor="#F44336"
                           Padding="15"
                           CornerRadius="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="ðŸ“‰ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="#C62828"/>

                            <CollectionView ItemsSource="{Binding ExpenseCategories}"
                                            SelectionMode="None">

                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="White" 
                                               Padding="10" CornerRadius="8"
                                               Margin="0,0,0,5">
                                            <Grid ColumnDefinitions="Auto,*,Auto">
                                                <!-- Ð¦Ð²ÐµÑ‚ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                                                <BoxView Color="{Binding Color}"
                                                         WidthRequest="20"
                                                         HeightRequest="20"
                                                         CornerRadius="10"
                                                         Grid.Column="0"
                                                         VerticalOptions="Center"/>

                                                <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ -->
                                                <Label Text="{Binding Name}" 
                                                       Grid.Column="1"
                                                       FontSize="14"
                                                       VerticalOptions="Center"
                                                       Margin="10,0"/>

                                                <!-- Ð‘ÑŽÐ´Ð¶ÐµÑ‚ -->
                                                <Label Text="{Binding MonthlyBudget, StringFormat='Ð‘ÑŽÐ´Ð¶ÐµÑ‚: {0:C}'}" 
                                                       Grid.Column="1"
                                                       FontSize="12"
                                                       TextColor="Gray"
                                                       VerticalOptions="Center"
                                                       HorizontalOptions="End"/>

                                                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ -->
                                                <Button Text="ðŸ—‘ï¸" 
                                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteCategoryCommand}"
                                                        CommandParameter="{Binding .}"
                                                        BackgroundColor="Transparent"
                                                        TextColor="#F44336"
                                                        FontSize="14"
                                                        Grid.Column="2"/>
                                            </Grid>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ -->
                <Button Text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº" 
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        IsEnabled="{Binding IsNotBusy}"
                        IsVisible="{Binding HasData}"/>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð½Ð°Ð·Ð°Ð´ -->
                <Button Text="â† ÐÐ°Ð·Ð°Ð´" 
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="#757575"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="40"
                        Margin="0,20"/>

            </VerticalStackLayout>
        </ScrollView>
    </RefreshView>

</ContentPage>